<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('meta'); %>
    <title>Checkout</title>
  </head>
  <body>
    <div class="container">
      <%- include('navbar'); %>
      <h1>Checkout</h1>
      <h2 id="cart_items"></h2>
      <h2 id="total"></h2>
      <form action="">
        <label for="name">Name:</label>
        <input type="text" name="name" id="name" required />

        <label for="email">Email:</label>
        <input type="email" name="email" id="email" required />

        <label for="address">Address:</label>
        <textarea
          name="address"
          id="address"
          cols="30"
          rows="10"
          required
        ></textarea>

        <label for="payment">Payment Method:</label>
        <select name="payment" id="payment">
          <option value="credit-card">Credit Card</option>
          <option value="paypal">PayPal</option>
          <option value="stripe">Stripe</option>
        </select>

        <button type="submit">Place Order</button>
        <a href="home">Back to shop</a>
      </form>
    </div>
    <script
      src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
      integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
      crossorigin="anonymous"
    ></script>

    <script type="text/javascript">
      var sizes = JSON.parse('<%- JSON.stringify(sizes) %>');

      let total = 0;
      for (let i = 0; i < localStorage.length; i++) {
        let product = localStorage.key(i);
        let order = new Map(JSON.parse(localStorage.getItem(product)));
        order.forEach((quantity, size) => {
          document.getElementById('cart_items').innerHTML +=
            quantity +
            ' x ' +
            product +
            ' ' +
            sizes[size - 1].dimx +
            'x' +
            sizes[size - 1].dimy +
            'cm (€' +
            sizes[size - 1].price * quantity +
            ')<br>';
          total += sizes[size - 1].price * quantity;
        });
      }
      document.getElementById('total').innerHTML =
        'Total: €' + total.toFixed(2);
    </script>
  </body>
</html>
