<!DOCTYPE html>
<html>
  <head>
    <%- include('meta'); %>
    <title><%= title %> Movie Poster</title>
  </head>
  <body>
    <div class="container" id="carousel-contain">
      <%- include('navbar'); %>
      <!-- Row with carousel and movie description -->
      <div class="row justify-content-between gx-5 d-lg-block">
        <div class="col-lg-8 float-start">
          <!-- Carousel -->
          <div id="itemCarousel" class="carousel slide pb-4">
            <div class="carousel-inner">
              <div class="carousel-item" id="img1">
                <img
                  src="./assets/<%= image1 %>"
                  alt="<%= title %> alternative movie poster"
                  class="d-block w-100"
                />
              </div>
              <div class="carousel-item" id="img2">
                <img
                  src="./assets/<%= image2 %>"
                  alt="<%= title %> alternative movie poster"
                  class="d-block w-100"
                />
              </div>
              <div class="carousel-item">
                <img
                  src="./assets/<%= image3 %>"
                  alt="<%= title %> alternative movie poster"
                  class="d-block w-100"
                />
              </div>
            </div>
            <button
              class="carousel-control-prev"
              type="button"
              data-bs-target="#itemCarousel"
              data-bs-slide="prev"
            >
              <span
                class="carousel-control-prev-icon"
                aria-hidden="true"
              ></span>
              <span class="visually-hidden">Previous</span>
            </button>
            <button
              class="carousel-control-next"
              type="button"
              data-bs-target="#itemCarousel"
              data-bs-slide="next"
            >
              <span
                class="carousel-control-next-icon"
                aria-hidden="true"
              ></span>
              <span class="visually-hidden">Next</span>
            </button>
          </div>
        </div>
        <!-- Item info -->
        <div class="col-lg-4 float-end">
          <h1 id="product"><%= title %></h1>
          <h3 class="mb-4">A <%= director %> Film</h3>
          <h5>Dimensions:</h5>
          <select name="size" id="size" class="form-select">
            <option disabled selected>Select dimensions</option>
            <% for (let i = 0; i < sizes.length; i++) {%>
            <option value="<%= sizes[i].sizeid %>">
              <%= sizes[i].dimx %> x <%= sizes[i].dimy %> cm (€<%=
              sizes[i].price %>)
            </option>
            <% } %>
          </select>

          <button
            onclick="addToCart()"
            type="button"
            class="btn btn-outline-dark col-12 mb-4"
          >
            Add to cart
          </button>
          <div class="row justify-content-between mb-2">
            <h5 class="col m-0">Genre</h5>
            <div class="col text-end">
              <a
                class="link-offset-2 link-offset-3-hover link-underline link-underline-opacity-0 link-underline-opacity-75-hover"
                href="/genre?gid=<%= gid %>"
                ><h5 class="m-0"><%= genre %></h5></a
              >
            </div>
          </div>
          <h5>Description</h5>
          <p>
            Alternative movie posters created by the movie fan for the movie
            fans. A tribute piece for those who brought my favorite films to
            life.
          </p>
          <p>
            The chic minimalist design will complement any wall in your house or
            office, adding a distinctively modern sensibility. Printed on fine
            archival paper with high-quality ink, it will last for years to
            come.
          </p>
          <p>
            This item is for PRINT only. Frame shown in the picture is not part
            of the item.
          </p>
          <p>
            Because the item is made to order, all sales are final. I do not
            accept return items. But if you receive a damaged item or a wrong
            print, please send me a message with the photos and I'll gladly send
            you another one.
          </p>
          <h1>Hi</h1>
        </div>
        <div class="col-lg-8 float-start">
          <h3 class="ms-2">Reviews</h3>
          <ul class="list-group list-group-flush">
            <% for (let i = 0; i < reviews.length; i++) {%>
            <li class="list-group-item d-flex <%= reviews[i].prodid === prodid ? "reviewed" : "" %>">
              <div class="me-auto">
                <h5 class="me-2 d-inline-block"><%= reviews[i].username %></h5>
                <small>
                  <%= reviews[i].prodid === prodid ? "reviewed this item" :
                  "reviewed another item" %>
                </small>
                <br />
                <p class="mb-2"><%= reviews[i].text %></p>
                <small><%= reviews[i].date.toLocaleDateString("en-GB") %></small>
              </div>
              <span class="review-stars"
                ><%= "★".repeat(reviews[i].stars) %><%= "☆".repeat(5 -
                reviews[i].stars) %></span
              >
            </li>
            <% } %>
          </ul>
        </div>
      </div>
    </div>

    <script
      src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
      integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
      crossorigin="anonymous"
    ></script>

    <script type="text/javascript">
      // Randomly selects image 1 or 2 as the starting carousel image
      const rand = Math.random() < 0.5;
      const img1 = document.getElementById('img1');
      const img2 = document.getElementById('img2');
      rand ? img1.classList.add('active') : img2.classList.add('active');

      function addToCart() {
        let product = document.getElementById('product').innerHTML;
        let order = new Map();
        if (localStorage.getItem(product) != null) {
          order = new Map(JSON.parse(localStorage.getItem(product)));
        }
        let item = parseInt(document.getElementById('size').value);
        order.set(item, order.get(item) + 1 || 1);

        localStorage.setItem(
          product,
          JSON.stringify(Array.from(order.entries()))
        );

        window.location.href = 'checkout';
      }
    </script>
  </body>
</html>
